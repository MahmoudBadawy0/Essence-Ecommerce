<div class="max-w-xl mx-auto my-12 p-6 bg-white rounded-lg shadow-md dark:bg-gray-800">
  <!-- Email Verification Form -->

  @if (step===1) {
  <form [formGroup]="verifyEmail" (ngSubmit)="verifyEmailSubmit()" class="space-y-6">
    <!-- header -->
    <div>
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Reset Your Password</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Please enter your email to send a verification code.</p>
      @if (msgError) {
      <p class="text-sm  text-red-600">{{msgError}}.</p>
      }
    </div>

    <!-- inputs -->
    <div>
      <label for="email" class="lb-auth">Email</label>
      <input formControlName="email" id="email" type="email" placeholder="name@company.com"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#855825] focus:border-[#855825] block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">

      @let emailControl=verifyEmail.get('email');
      @if (emailControl?.errors && emailControl?.touched) {
      <div class="mt-2 text-sm text-red-600">
        @if (emailControl?.getError('required')) {
        <span>Email is required</span>
        }
        @else if (emailControl?.getError('pattern')) {
        <span>Please enter a valid email</span>
        }
      </div>

      }


    </div>

    <!-- submit -->
    <button type="submit" class="btn-auth" [disabled]="isLoading">
      @if (isLoading) {
      <i class="fas fa-spinner fa-spin me-2" aria-hidden="true"></i>
      }
      Send Verification Code
    </button>



  </form>
  }
  @else if (step===2) {
  <!-- Code Verification Form -->
  <form [formGroup]="verifyCode" (ngSubmit)="verifyCodeSubmit()" class="space-y-6">
    <div>
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Verify Code</h3>
      <p class="text-sm text-gray-500">
        Please enter the verification code sent to your email
      </p>
      @if (msgError) {
      <p class="text-sm  text-red-600">{{msgError}}.</p>
      }
    </div>

    <div>
      <label for="code" class="lb-auth">Verification Code</label>
      <input type="text" id="code" formControlName="resetCode"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#855825] focus:border-[#855825] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
        placeholder="Enter 6-digit code">

      @let codeControl=verifyCode.get('resetCode');
      @if (codeControl?.errors && codeControl?.touched) {
      <div class="mt-2 text-sm text-red-600">
        @if (codeControl?.getError('required')) {
        <span>Code is required</span>
        }
        @else if (codeControl?.getError('pattern')) {
        <span>Must be 6 characters</span>
        }
      </div>

      }
    </div>

    <button type="submit" [disabled]="isLoading" class="btn-auth">
      @if (isLoading) {
      <i class="fas fa-spinner fa-spin me-2" aria-hidden="true"></i>
      }
      Verify Code
    </button>

  </form>
  }

  @else if (step===3) {
  <!-- Password Reset Form -->
  <form [formGroup]="resetPassword" (ngSubmit)="resetPasswordSubmit()" class="space-y-6">

    <div>
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Set New Password</h3>
      <p class="text-sm text-gray-500">Please enter your new. Ensure it differs from previous ones for security</p>

      @if (msgError) {
      <p class="text-sm  text-red-600">{{msgError}}.</p>
      }
    </div>

    <div>
      <label for="reset-email" class="lb-auth">Email</label>
      <input type="email" readonly placeholder="name@company.com" id="reset-email" formControlName="email"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#855825] focus:border-[#855825] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">

      @let mailControl=resetPassword.get('email');
      @if (mailControl?.errors && mailControl?.touched) {
      <div class="mt-2 text-sm text-red-600">
        @if (mailControl?.getError('required')) {
        <span>Email is required</span>
        }
        @else if (mailControl?.getError('pattern')) {
        <span>Please enter a valid email</span>
        }
      </div>
      }
    </div>

    <div>
      <label for="new-password" class="lb-auth">New Password</label>
      <input id="new-password" formControlName="newPassword" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#855825] focus:border-[#855825] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600
            dark:placeholder-gray-400 dark:text-white" placeholder="New Password" type="password">


      @let newPasswordControl=resetPassword.get('newPassword');
      @if (newPasswordControl?.errors && newPasswordControl?.touched) {
      <div class="mt-2 text-sm text-red-600">
        @if (newPasswordControl?.getError('required')) {
        <span>Password is required</span>
        }
        @else if (newPasswordControl?.getError('pattern')) {
        <span> Password must be at least 8 characters with 1 uppercase and 1 special character</span>
        }
      </div>

      }

    </div>

    <button type="submit" class="btn-auth" [disabled]="isLoading">
      @if (isLoading) {
      <i class="fas fa-spinner fa-spin me-2" aria-hidden="true"></i>
      }
      Reset Password
    </button>

  </form>
  }
  <!-- Back Navigation -->
  <div class="mt-4 text-sm text-center text-gray-500 dark:text-gray-400 flex items-center ">

    <!-- if you don't need back btn remove this  -->
    @if (step===2 || step===3) {
    <div class="me-auto cursor-pointer" (click)="goBack()">
      <a class="block hover:bg-[#855825]/10  rounded-lg py-2 px-3 text-sm font-medium text-[#855825] dark:text-white md:dark:hover:text-[#855825] dark:hover:bg-gray-700 dark:hover:text-white transition-colors"
        aria-current="page">
        <i class="fa fa-arrow-left text-lg" aria-hidden="true"></i>
      </a>
    </div>
    }

    <p> Remember your password?
      <a routerLink="/login" class="text-[#855825] hover:underline dark:text-[#c58d5a]">Login here</a>
    </p>

  </div>

</div>